---
title: "Final exercise"
author: 
  - "Felix Zaussinger"
date: "10.09.2020"
output:
  xaringan::moon_reader:
    css: xaringan-themer.css
    nature:
      highlightStyle: github
      highlightLines: true
      countIncrementalSlides: false
---

```{r setup, include=FALSE}
options(htmltools.dir.version = FALSE)
knitr::opts_chunk$set(fig.retina = 3, message = FALSE) #rendering sharp plots / not showing messages
```

```{r xaringan-themer, include=FALSE, warning=FALSE}
library(xaringanthemer)
style_mono_light(base_color = "#23395b")
library(tidyverse)
```

### Election day registration & voter turnout in the US
.pull-left[
- The majority of states require voters to *register two to four weeks before an election*. [(Wikipedia)](https://en.wikipedia.org/wiki/Voter_registration_in_the_United_States#Election_Day_/_same-day)

- "There is *strong evidence that same day and Election Day registration increases voter turnout*, but the extent of the impact is difficult to conclude. 

- Multiple studies place the *effect between an increase of 3 to 7 percent*, with an **average of a 5 percent increase**." [(NCLS)](https://www.ncsl.org/research/elections-and-campaigns/same-day-registration.aspx)
]

--

.pull-right[
<img src="figures/EDR.jpeg" width="500" />
[(Source: businessinsider.com, November 2018.)](https://www.businessinsider.com/last-day-voter-registration-deadline-by-state-2018-10?r=US&IR=T)
]


---
# Exercise

- We want to examine the *effect of election day registration upon voter turnout*.

- Specifically, what is the *causal effect* of EDR upon voter turnout?

- Is our estimate in the range of values provided in the literature, i.e., 3-7% with 5% on average?

--

<img src="figures/cartoon-causation.png" width="400" />

[*(Source: Andertoons)*](https://andertoons.com/science/cartoon/7252/correlation-does-not-imply-causation-we-know-it-was-brian)

---
# The data set

We use data on **US states** for all **presidential elections from 1920 to 2012**.

.pull-left[
```{r, warning=FALSE}
# load data set
library(gsynth)
data(gsynth)
rm(list = c("simdata"))
```
]
.pull-right[
Reference: [*Melanie Jean Springer. 2014. How the States Shaped the Nation: American Electoral Institutions and Voter Turnout, 1920-2000. University of Chicago Press.*](https://rdrr.io/cran/gsynth/man/turnout.html)
]

---

```{r, warning=FALSE}
# inspect data
str(turnout)

# unique states
length(unique(turnout$abb))

# unique years
length(unique(turnout$year))
```

---
### Exercise 1 (~ 20 min)
The state **Maine** introduced election day registration in the year **1976**. 

1) **Plot turnout** in Maine over the 1920-2012 period.

2) **Distinguish between the period before and after EDR was introduced**: These are commonly called the **"pre-" and "post-treatment"** periods, respectively, where "treatment" refers to the introduction of EDR.

3) **Update your plot**: we want to visualise the time EDR was introduced, the accompanying pre- and post-treatment periods and the mean values of pre- and post-treatment turnout in Maine. 

4) **Bonus**: Did mean turnout change significantly before and after 1976?

---
### 1) Plot turnout in Maine over 1920 - 2012.

.pull-left[
```{r, maine1, fig.show = 'hide', warning=FALSE}
turnout_maine <- turnout %>%
  filter(abb == 'ME')

ggplot(turnout_maine) +
  aes(y=turnout, x=year) +
  geom_line() + 
  geom_point() + 
  theme_xaringan()
```
]
.pull-right[
```{r ref.label = 'maine1', echo = FALSE, warning=FALSE}
```
]

---
### 2) Distinguish between pre- and post-EDR periods

```{r}
# filter and mutate
turnout_maine <- turnout_maine %>%
  mutate(treatment=ifelse(year >= 1976, 1, 0))

# disentangle treatment groups
pre <- turnout_maine %>% 
  filter(treatment == 0)
post <- turnout_maine %>% 
  filter(treatment == 1)
```

---
### 3) Update plot

.pull-left[
```{r maine2, fig.show = 'hide', warning=FALSE}
ggplot(turnout_maine) +
  aes(y=turnout, x=year) +
  geom_line() + 
  geom_point() + 
  geom_vline(xintercept=1976) +
  geom_segment(
    x=first(pre$year), 
    xend=last(pre$year), 
    y=mean(pre$turnout), 
    yend=mean(pre$turnout),
    color='darkgreen') +  
  geom_segment(
    x=first(post$year), 
    xend=last(post$year), 
    y=mean(post$turnout), 
    yend=mean(post$turnout),
    color='darkred') +
  labs(
    title = "Maine",
    x = "Year", 
    y = "Voter turnout (%)") +
  theme_xaringan()
```
]
.pull-right[
```{r ref.label = 'maine2', echo = FALSE, warning=FALSE}
```
]

---
### 4) Bonus: Significance check

.pull-left[
```{r}
ttest <- t.test(
  x=pre$turnout, 
  y=post$turnout,
  mu=0,
  conf.level = 0.05, 
  alternative = "two.sided"
  )
```
]
.pull-right[
The pre-treatment mean turnout rate in Maine is `r round(mean(pre$turnout), 2) `%, while the post-treatment mean turnout rate is `r round(mean(post$turnout), 2)`%. 

The difference between pre- and post-treatment is `r round(mean(post$turnout) - mean(pre$turnout), 2) `%. 

A t-test confirms that this result is statistically significant at the 95% confidence level (p = `r round(ttest$p.value, 3)`).
]



---
### Exercise 2 (~ 20 min)

Plot turnout across all states over time, distinguishing between election day registration states and non-election day registration states, as well as when election day registration was introduced.

> TODO: provide better description

---
### Solution to Exercise 2

> TODO: break down into many smaller chunks that fit one slide each
> TODO: tidyversify code. use functions that were introduced by Colin.

.pull-left[
```{r did1, echo = FALSE, warning=FALSE}
yrs <- unique(turnout$year) # years
states <- unique(turnout$abb) # all states

# treatment group data
states_E1 <- unique(filter(turnout, (policy_edr == 1 & year == 1976))$abb) 

# control group data
states_E0 <- turnout %>%
  group_by(abb) %>%
  summarise(sum_policy_edr = sum(policy_edr)) %>% 
  filter(sum_policy_edr == 0) %>% 
  select(abb)
states_E0 <- states_E0$abb

# Control group elements: E0T0, E0T1
E0 <- turnout %>% filter(abb %in% states_E0)
E0T0 <- E0 %>% filter(year < 1976)
E0T1 <- E0 %>% filter(year >= 1976)

E0T0_mean <- E0T0 %>%
  group_by(year) %>%
  summarise(mean_turnout = mean(turnout))

E0T1_mean <- E0T1 %>%
  group_by(year) %>%
  summarise(mean_turnout = mean(turnout))

# Treatment group elements: E1T0, E1T1
E1 <- turnout %>% filter(abb %in% states_E1)
E1T0 <- E1 %>% filter(year < 1976)
E1T1 <- E1 %>% filter(year >= 1976)

E1T0_mean <- E1T0 %>%
  group_by(year) %>%
  summarise(mean_turnout = mean(turnout))

E1T1_mean <- E1T1 %>%
  group_by(year) %>%
  summarise(mean_turnout = mean(turnout))

# plot
ggplot() +
  geom_vline(xintercept=1976, linetype='dashed') + 
  # E0T0
  geom_point(data = E0T0_mean, aes(x=year, y=mean_turnout), colour='red') +
  geom_line(data = E0T0_mean, aes(x=year, y=mean_turnout), colour='red') +
  geom_segment(data = E0T0_mean, x=first(E0T0_mean$year), xend=last(E0T0_mean$year), 
               y=mean(E0T0_mean$mean_turnout), yend=mean(E0T0_mean$mean_turnout), 
               color='red', linetype='dashed') +
  # E0T1
  geom_point(data = E0T1_mean, aes(x=year, y=mean_turnout), colour='red') + 
  geom_line(data = E0T1_mean, aes(x=year, y=mean_turnout), colour='red') + 
  geom_segment(data = E0T1_mean, x=first(E0T1_mean$year), xend=last(E0T1_mean$year), 
               y=mean(E0T1_mean$mean_turnout), yend=mean(E0T1_mean$mean_turnout), 
               color='red', linetype='dashed') +
  # E1T0
  geom_point(data = E1T0_mean, aes(x=year, y=mean_turnout), colour='darkblue') + 
  geom_line(data = E1T0_mean, aes(x=year, y=mean_turnout), colour='darkblue') + 
  geom_segment(data = E1T0_mean, x=first(E1T0_mean$year), xend=last(E1T0_mean$year), 
               y=mean(E1T0_mean$mean_turnout), yend=mean(E1T0_mean$mean_turnout), 
               color='darkblue', linetype='dashed') +
  
  # E1T1
  geom_point(data = E1T1_mean, aes(x=year, y=mean_turnout), colour='darkblue') + 
  geom_line(data = E1T1_mean, aes(x=year, y=mean_turnout), colour='darkblue') + 
  geom_segment(data = E1T1_mean, x=first(E1T1_mean$year), xend=last(E1T1_mean$year), 
               y=mean(E1T1_mean$mean_turnout), yend=mean(E1T1_mean$mean_turnout), 
               color='darkblue', linetype='dashed') + 
  # labeling
  labs(title = "Turnout across states",
       x = "Year", y = "Mean voter turnout (%)") + 
  theme_xaringan()
```
]
.pull-right[
Of the `r length(states)` states included in the data set, `r length(states_E1)` (`r states_E1`) have introduced election day registration in 1976. `r length(states_E0)` states have not introduced it at all throughout the 1920-2012 time period. This leaves us with `r length(states) - length(states_E0) - length(states_E1)` states that introduced election day registration in years other than 1976.

The figure shows group-aggregated mean voter turnout over time. It can easily be seen that the treatment-group mean increased between pre- and post-treatment, while the control-group mean actually declined minimally.
]

---
# Exercise 3

Estimate the average effect of EDR on voter turnout.

> TODO: provide better description

---
# Solution to Exercise 3 (~ 5 min)

> TODO: tidyversify
> TODO: add barplot

.pull-left[
```{r did2, warning=FALSE}

# treatment group difference
diff_treatment <- 
  mean(E1T1$turnout) - 
  mean(E1T0$turnout)

# control group difference
diff_control <-
  mean(E0T1$turnout) - 
  mean(E0T0$turnout)

# treatment - control
DID <- diff_treatment - 
  diff_control
```
]
.pull-right[
The effect of EDR on voter turnout is `r round(DID, 2)`%.
]
